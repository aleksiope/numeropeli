<!DOCTYPE html>
<html lang="fi">
<head>
  <meta charset="UTF-8">
  <title>Numeropeli</title>
  <style>
    body { font-family: sans-serif; text-align: center; }
    #grid {
      display: grid;
      grid-template-columns: repeat(6, 60px);
      grid-template-rows: repeat(6, 60px);
      gap: 5px;
      margin: 20px auto;
      width: max-content;
    }
    .cell {
      width: 60px;
      height: 60px;
      border: 1px solid #333;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      cursor: pointer;
      background-color: #f0f0f0;
    }
    .cell.filled {
      background-color: #b2f0b2;
      cursor: default;
    }
    .controls {
      margin-top: 10px;
    }
    button {
      padding: 8px 16px;
      font-size: 16px;
      margin: 0 5px;
    }
  </style>
  
</head>
<body>
  <h1>Numeropeli</h1>
  <p>Klikkaa ruutuja järjestyksessä 1–36 sääntöjen mukaan.</p>
  <p>Voit asettaa seuraavan luvun vaaka- tai pystysuunnassa kolmen ruudun päähän tai vinottain kahden ruudun päähän.</p>
  <p>Voit peruuttaa siirtosi yhden kerran.</p>
  <div id="grid"></div>
  <p id="status">Seuraava luku: 1</p>
  <p id="best">Paras tulos: -</p>
  <div class="controls">
    <button id="undoBtn">Peruuta siirto</button>
    <button id="resetBtn">Aloita alusta</button>
  </div>
  <p><small>©️KAN</small></p>
  <script>
    const gridSize = 6;
    let currentNumber = 1;
    const grid = document.getElementById('grid');
    const status = document.getElementById('status');
    const bestDisplay = document.getElementById('best');
    const resetBtn = document.getElementById('resetBtn');
    const undoBtn = document.getElementById('undoBtn');
    const cells = [];

    let bestScore = localStorage.getItem('numeropolkuBest') || 0;
    if (bestScore > 0) {
      bestDisplay.textContent = `Paras tulos: ${bestScore}`;
    }

    function initGrid() {
      grid.innerHTML = '';
      cells.length = 0;
      for (let row = 0; row < gridSize; row++) {
        for (let col = 0; col < gridSize; col++) {
          const cell = document.createElement('div');
          cell.classList.add('cell');
          cell.dataset.row = row;
          cell.dataset.col = col;
          grid.appendChild(cell);
          cells.push(cell);
        }
      }
    }

    let path = [];
    let undoUsed = false;

    function resetGame() {
      currentNumber = 1;
      path = [];
      undoUsed = false;
      status.textContent = "Seuraava luku: 1";
      initGrid();
    }

    function undoMove() {
      if (undoUsed || path.length === 0) return;
      const last = path.pop();
      const index = last.row * gridSize + last.col;
      const cell = cells[index];
      cell.textContent = '';
      cell.classList.remove('filled');
      currentNumber--;
      status.textContent = `Seuraava luku: ${currentNumber}`;
      undoUsed = true;
    }

    function hasValidMoves(row, col) {
      const directions = [
        {dx: 3, dy: 0}, {dx: -3, dy: 0},
        {dx: 0, dy: 3}, {dx: 0, dy: -3},
        {dx: 2, dy: 2}, {dx: -2, dy: 2},
        {dx: 2, dy: -2}, {dx: -2, dy: -2},
      ];
      return directions.some(d => {
        const newRow = row + d.dy;
        const newCol = col + d.dx;
        if (newRow < 0 || newRow >= gridSize || newCol < 0 || newCol >= gridSize) return false;
        const index = newRow * gridSize + newCol;
        return !cells[index].classList.contains('filled');
      });
    }

    function checkGameOver() {
      if (path.length === 0) return;
      const last = path[path.length - 1];
      if (!hasValidMoves(last.row, last.col)) {
        status.textContent = "Ei enää mahdollisia siirtoja. Peli päättyi.";
        if (path.length > bestScore) {
          bestScore = path.length;
          localStorage.setItem('numeropolkuBest', bestScore);
          bestDisplay.textContent = `Paras tulos: ${bestScore}`;
        }
      }
    }

    grid.addEventListener('click', (e) => {
      const cell = e.target;
      if (!cell.classList.contains('cell') || cell.classList.contains('filled')) return;

      const row = parseInt(cell.dataset.row);
      const col = parseInt(cell.dataset.col);

      if (isValidMove(row, col)) {
        cell.textContent = currentNumber;
        cell.classList.add('filled');
        path.push({row, col, number: currentNumber});
        currentNumber++;
        if (currentNumber > 36) {
          status.textContent = "Peli päättyi! Kaikki numerot asetettu.";
          if (path.length > bestScore) {
            bestScore = path.length;
            localStorage.setItem('numeropolkuBest', bestScore);
            bestDisplay.textContent = `Paras tulos: ${bestScore}`;
          }
        } else {
          status.textContent = `Seuraava luku: ${currentNumber}`;
          checkGameOver();
        }
      } else {
        alert("Virheellinen siirto sääntöjen mukaan!");
      }
    });

    resetBtn.addEventListener('click', resetGame);
    undoBtn.addEventListener('click', undoMove);

    function isValidMove(row, col) {
      if (path.length === 0) return true;
      const last = path[path.length - 1];
      const dx = col - last.col;
      const dy = row - last.row;
      if (row === last.row && Math.abs(dx) === 3) return true;
      if (col === last.col && Math.abs(dy) === 3) return true;
      if (Math.abs(dx) === 2 && Math.abs(dy) === 2) return true;
      return false;
    }

    initGrid();
  </script>
</body>
</html>
